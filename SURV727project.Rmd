---
output:
  html_document: default
  word_document: default
  pdf_document: default
---
# SURV727-Project
---
title: "Sentiment Analysis of Tweets on Georgia Abortion Law"
subtitle: "SURV727 Term Paper"
author: "Akipu Ehoche and Ellena Sempeles"
date: "`r Sys.Date()`"
output:
  pdf_document:
    toc: yes
    df_print: kable
 references:
- id: Blazina2022
  title: Key facts about the abortion debate in America
  author:
  - family: Blazina
    given: C.
  container-title: Pew Research
  type: article-online
  issued:
    year: 2022
- id: BellwareRoubein2022
  title: Judge overturns Georgia’s six-week abortion ban
  author:
  - family: Bellware
    given: K.
  - family: Roubein
    given: R.
  type: article-online
  container-title: The Washington Post
  issued:
    year: 2022
- id: Thanawala2022
  title: Georgia Supreme Court reinstates ban on abortions after 6 weeks of pregnancy
  author:
  - family: Thanawala
    given: S.
  type: article-online
  container-title: PBS
  issued:
    year: 2022
---

```{r, include = FALSE}
library(knitr)
library(tidyverse)
library(rtweet)
library(tidytext)
library(qdap)
library(lubridate)
library(tm)
```
## Introduction
In June of 2022, the Supreme Court issued its decision in Dobbs vs. Jackson Women’s Health, overturning Roe vs. Wade, eliminating the federal standard protecting the right to abortion. This sparked a major political and morality debate across the American population, where opinions and comments were shared via various social media platforms, including Twitter. According to a survey of U.S. adults conducted by Pew Research Center in the summer of 2022, a majority of the U.S. public disapproves of the Supreme Court's decision. Roughly 57% of adults disapprove of the court's decision, including 43% who strongly disapprove, while 41% approve, including 25% who strongly approve [@Blazina2022].The state of Georgia’s abortion law was among of the strictest in the country, banning abortion after the detection of fetal cardiac activity, at roughly six weeks. However, as of November 15th, 2022, a breaking news story reported that a Fulton County judge overturned Georgia’s six-week abortion ban [@BellwareRoubein2022]. Then, as of November 23rd, 2022, the state attorney general's office appealed the ruling to the state Supreme Court, allowing the six-week abortion ban to take effect once again [@Thanawala2022]. Given the country's divide on the issue of abortion and the back and forth of Georgia's legislation, we are interested in the emotional reactions of Twitter users' tweets on these changes of legislation. Our questions include:
1) What are people saying about the changes in Georgia’s abortion law? 
2) Are their reactions positive or negative?
3) Do the sentiment of the tweets change as the legislative events change?

This paper provides a sentiment analysis of Twitter users' tweets on the topic of abortion in the state of Georgia.

## Data
Two corpuses of tweets were collected to examine the sentiment of Twitter users regarding the Georgia abortion ban. Using the Twitter API, a total of 17,415 tweets were collected over two periods of time, after the abortion ban was overturned and after it was reinstated. The first corpus was collected for a span of 12 hours starting at 10:00PM EST on November 15, 2022. Given that the abortion ban was overturning on that specific day, this corpus of tweets captured Twitter users' reaction to the the overturning. This corpus included a total of 3,083 tweets. This corpus will be referred as the "Abortion Ban Overturned" corpus moving forward. The second corpus was collected for a span of 12 hours starting at 3:00PM EST on November 23, 2022. Internet disruptions were experienced while streaming this corpus of tweets, so this corpus was collected in three installments and combined into one corpus. This corpus of tweets captured Twitter users reactions after the news of the ban reinstatement. This corpus included a total of 14,332 tweets. This corpus will be referred to as the "Abortion Ban Reinstated" corpus moving forward.


```{r, eval=FALSE, include=FALSE}
## Data Gathering Process
# First corpus of tweets (GA Abortion Law Overturned):
ban_tweets <- stream_tweets(
  q = "georgia ban abortion",
  timeout = 43200,
  file_name = "tweet1",
  parse = FALSE
)

#Second corpus of tweets (GA Abortion Law Reinstated):
ban_tweets <- stream_tweets(
  q = "georgia ban abortion",
  timeout = 4314,
  file_name = "tweet2",
  parse = FALSE
)
ban_tweets <- stream_tweets(
  q = "georgia ban abortion",
  timeout = 27672,
  file_name = "tweet3",
  parse = FALSE
)
ban_tweets <- stream_tweets(
  q = "georgia ban abortion",
  timeout = 15600,
  file_name = "tweet4",
  parse = FALSE
)

```




```{r, warning=FALSE, include=FALSE, results='hide'}
# Parse from json file to get a usable dataframe
ovt_tweets = parse_stream("tweet1")
tweets2 = parse_stream("tweet2") 
tweets3 = parse_stream("tweet3")
tweets4 = parse_stream("tweet4")

#Combine GA Abortion Law Reinstated tweets into one corpus:
reinst_tweets = rbind(tweets2, tweets3, tweets4)

#Totals for number of tweets per corpus:
nrow(ovt_tweets)
nrow(reinst_tweets)
```
Next, we investigated the frequency of the tweets over time within each corpus. This would help us better understand the behavior of the Twitter users' as the topic of Georgia's abortion law was discussed. The two plots below show the number of tweets per minute for the Abortion Ban Overturned and Abortion Ban Reinstated corpuses.

**Add language here describing the frequency of tweets per corpus according to the graphs.

```{r, include=FALSE }
ovt_tweets$datetime <- ymd_hms(ovt_tweets$created_at)
ovtw <- ovt_tweets %>% 
  ggplot(aes(datetime)) + 
  geom_freqpoly(binwidth = 60)  # 60 seconds = 1 minute
ovtw + labs(title = "Abortion Law Overturned Tweets collected over time")
```
The first corpus of tweets were collected between 9pm and 10am on 15th-16th November 2022.

```{r, include=FALSE}
reinst_tweets$datetime <- ymd_hms(tweets$created_at)
retw <- reinst_tweets %>% 
  ggplot(aes(datetime)) + 
  geom_freqpoly(binwidth = 60)  # 60 seconds = 1 minute
retw + labs(title = "Abortion Law Reinstated Tweets collected over time")
```
The first corpus of tweets were collected between 2pm and 3am on 23rd-24th November 2022. 

Next we did some initial cleaning. This includes removing websites, changing punctuation tags to just punctuation,unnecessary words and stopwords. 
We did this for both of the corpuses.

```{r, include=FALSE, results='hide'}
###INITIAL CLEANING###
##Initial Cleaning the Abortion Ban Overturned corpus:
ovt_corpus <- iconv(ovt_tweets$text)
ovt_corpus <- Corpus(VectorSource(ovt_corpus))
inspect(ovt_corpus[1:5])

#Covert words to lower case, remove punctuation/numbers/stopwords/websites/extra spaces:
ovt_corpus <- tm_map(ovt_corpus, tolower)
ovt_corpus <- tm_map(ovt_corpus, removeWords, c('rt @'))
ovt_corpus <- tm_map(ovt_corpus, removePunctuation)
ovt_corpus <- tm_map(ovt_corpus, removeNumbers)
ovt_cleanset <- tm_map(ovt_corpus, removeWords, stopwords('english'))
removeURL <- function(x) gsub('http[[:alnum:]]*', '', x)
ovt_cleanset <- tm_map(ovt_cleanset, content_transformer(removeURL))
inspect(ovt_cleanset[1:5])

ovt_cleanset_df <- data.frame(ovt_cleanset)

##Initial Cleaning the Abortion Ban Reinstated corpus:
reinst_corpus <- iconv(reinst_tweets$text)
reinst_corpus <- Corpus(VectorSource(reinst_corpus))
inspect(reinst_corpus[1:5])

#Covert words to lower case, remove punctuation/numbers/stopwords/websites/extra spaces:
reinst_corpus <- tm_map(reinst_corpus, tolower)
reinst_corpus <- tm_map(reinst_corpus, removeWords, c('rt @'))
reinst_corpus <- tm_map(reinst_corpus, removePunctuation)
reinst_corpus <- tm_map(reinst_corpus, removeNumbers)
reinst_cleanset <- tm_map(reinst_corpus, removeWords, stopwords('english'))
removeURL <- function(x) gsub('http[[:alnum:]]*', '', x)
reinst_cleanset <- tm_map(reinst_cleanset, content_transformer(removeURL))
inspect(reinst_cleanset[1:5])

reinst_cleanset_df <- data.frame(reinst_cleanset)
```

Results
Data Exploration
We then inspected the top keywords for each of the corpuses for further cleaning.

```{r, include=FALSE}
#Plot of Keywords of Abortion Ban Overturned corpus after initial cleaning:
ovt_tweets_plot1a <- ovt_cleanset_df %>% select(text) %>% 
  unnest_tokens(word, text) %>%
  count(word, sort = TRUE) %>%
  top_n(25) %>%
  mutate(text = reorder(word, n)) %>%
  ggplot() +
  geom_col(aes(x = text, y = n)) +
  labs(title="Abortion Ban Overturned Keywords",
              subtitle = "After initial cleaning") +
  coord_flip() 
ovt_tweets_plot1 <- ovt_tweets_plot1a + theme(
plot.title = element_text(color="black", size=8, face="bold"),
                          plot.subtitle = element_text(color="black", size=8))
ovt_tweets_plot1

#Plot of Keywords of Abortion Ban Reinstated corpus after initial cleaning:
reinst_tweets_plot1a <- reinst_cleanset_df %>% select(text) %>%
  unnest_tokens(word, text) %>%
  count(word, sort = TRUE) %>%
  top_n(25) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot() +
  geom_col(aes(x = word, y = n)) +
  labs(title="Abortion Ban Reinstated Keywords",
              subtitle = "After initial cleaning") +
  coord_flip() 
reinst_tweets_plot1 <- reinst_tweets_plot1a + theme(
plot.title = element_text(color="black", size=8, face="bold"),
                          plot.subtitle = element_text(color="black", size=8))
reinst_tweets_plot1

```

Based on these plots, we found that more cleaning should be done prior to sentiment analysis.
For example, additional stopwords need to be removed:
just, now, around, week, day

Also, we used stemming techniques to further clean the tweets for analyses.
We also removed punctuation, symbols, and numbers (since all tweets will mention the 6-week abortion ban)


Using stemming to clean up the data, we get
```{r, include=FALSE, warning=FALSE, results='hide'}
#Additional Cleaning with Stemming
ovt_cleanset2 <- tm_map(ovt_cleanset, gsub,
                   pattern = 'weeks',
                   replacement = 'week')
ovt_cleanset2 <- tm_map(ovt_cleanset2, removeWords, c('6', 'six',"week","just","now","around","day","sixweek"))
ovt_cleanset2 <- tm_map(ovt_cleanset2, stemDocument)
ovt_cleanset2 <- tm_map(ovt_cleanset2, stripWhitespace)
inspect(ovt_cleanset2[1:5])

ovt_cleanset_df <- data.frame(ovt_cleanset2)
ovt_cleanset_df <- ovt_cleanset_df %>% dplyr::filter(!(text==""))

#Additional Cleaning with Stemming
reinst_cleanset2 <- tm_map(reinst_cleanset, gsub,
                   pattern = 'weeks',
                   replacement = 'week')
reinst_cleanset2 <- tm_map(reinst_cleanset2, removeWords, c('6', 'six',"week","just","now","around","day","sixweek"))
reinst_cleanset2 <- tm_map(reinst_cleanset2, stemDocument)
reinst_cleanset2 <- tm_map(reinst_cleanset2, stripWhitespace)
inspect(reinst_cleanset2[1:5])

reinst_cleanset_df <- data.frame(reinst_cleanset2)
reinst_cleanset_df <- reinst_cleanset_df %>% dplyr::filter(!(text==""))

```
```{r, include=FALSE}
#Plot of Keywords of Abortion Ban Overturned corpus after final cleaning:
ovt_tweets_plot2a <- ovt_cleanset_df %>% select(text) %>% 
  unnest_tokens(word, text) %>%
  count(word, sort = TRUE) %>%
  top_n(25) %>%
  mutate(text = reorder(word, n)) %>%
  ggplot() +
  geom_col(aes(x = text, y = n)) +
  labs(title="Abortion Ban Overturned Keywords",
              subtitle = "After final cleaning") +
  coord_flip() 
ovt_tweets_plot2 <- ovt_tweets_plot2a + theme(
plot.title = element_text(color="black", size=8, face="bold"),
                          plot.subtitle = element_text(color="black", size=8))
ovt_tweets_plot2

#Plot of Keywords of Abortion Ban Reinstated corpus after final cleaning:
reinst_tweets_plot2b <- reinst_cleanset_df %>% select(text) %>%
  unnest_tokens(word, text) %>%
  count(word, sort = TRUE) %>%
  top_n(25) %>%
  mutate(word = reorder(word, n)) %>%
  ggplot() +
  geom_col(aes(x = word, y = n)) +
  labs(title="Abortion Ban Reinstated Keywords",
              subtitle = "After final cleaning") +
  coord_flip() 
reinst_tweets_plot2 <- reinst_tweets_plot2b + theme(
plot.title = element_text(color="black", size=8, face="bold"),
                          plot.subtitle = element_text(color="black", size=8))
reinst_tweets_plot2
```
Comparing the two plots using the different cleaning methods side by side
```{r, include=FALSE}
library(patchwork)
ovt_tweets_plot1 + ovt_tweets_plot2
reinst_tweets_plot1 + reinst_tweets_plot2
```

Plot 1 represents cleaning up the data as described above while Plot 2 has formatted the words after the cleaning using stemming and removing additional stopwords.

Analysis
```{r,  message=FALSE}
##Sentiment Calculation
library(SentimentAnalysis)

#Sentiment of Abortion Law Overturned corpus:
ovt_tweets_sentiments = analyzeSentiment(iconv(as.character(ovt_cleanset_df$text), to='UTF-8'))
head(ovt_tweets_sentiments)
#How to get average?

#Sentiment of Abortion Law Reinstated corpus:
reinst_tweets_sentiments = analyzeSentiment(iconv(as.character(reinst_cleanset_df$text), to='UTF-8'))
head(reinst_tweets_sentiments)
#How to get average?

library(vader)
#Vader Sentiment of Abortion Law Overturned corpus:
ovt_tweets_vader_scores = vader_df(ovt_cleanset_df$text)
ovt_tweets_sentiments$Vader = ovt_tweets_vader_scores$compound
#Mean Sentiment:
mean(ovt_tweets_sentiments$Vader, na.rm=TRUE)

#Vader Sentiment of Abortion Law Reinstated corpus:
reinst_tweets_vader_scores = vader_df(reinst_cleanset_df$text)
reinst_tweets_sentiments$Vader = reinst_tweets_vader_scores$compound
#Mean Sentiment:
mean(reinst_tweets_sentiments$Vader, na.rm=TRUE)


##Sentiment of Abortion Law Overturned vs. Reinstated
library("RColorBrewer")
par(mfrow=c(1,2))
hist(ovt_tweets_sentiments$Vader, main='Sentiment of Abortion Law Overturned Tweets',cex.main = 0.8,cex.axis = 0.75, cex.lab = 0.75,xlab='Sentiment', ylim = c(0,8000))
hist(reinst_tweets_sentiments$Vader, main='Sentiment of Abortion Law Reinstated Tweets',cex.main = 0.8,cex.axis = 0.75,cex.lab = 0.75, xlab='Sentiment', ylim = c(0,8000))

```

```{r, include=TRUE}
library(syuzhet)
tweetso <- iconv(ovt_cleanset_df$text)
ovt <- get_nrc_sentiment(tweetso)
head(ovt)

tweetsr <- iconv(reinst_cleanset_df$text)
reinst <- get_nrc_sentiment(tweetsr)
head(reinst)

par(mfrow=c(1,2))
barplot(colSums(ovt),
        horiz = TRUE,
        cex.names = 0.7,
        cex.main = 0.8,
        las = 2,
        col = rainbow(10),
        xlab = 'Count',
        main = 'Sentiment of Abortion Law Overturned Tweets')


barplot(colSums(reinst),
        horiz = TRUE,
        cex.names = 0.7,
        cex.main = 0.8,
        las = 2,
        col = rainbow(10),
        xlab = 'Count',
        main = "Sentiment of Abortion Law Reinstated Tweets")
```

```{r, include=TRUE}
par(mfrow=c(1,2))
barplot(
  sort(colSums(prop.table(ovt[, 1:10]))), 
  horiz = TRUE, 
  cex.names = 0.7,
  cex.main = 0.8,
  las = 2, 
  col = rainbow(10),
  xlim = c(0, 0.6),
  main = "Emotions in Abortion Law Overturned tweets", xlab="Percentage"
)

barplot(
  sort(colSums(prop.table(reinst[, 1:10]))), 
  horiz = TRUE, 
  cex.names = 0.7, 
  cex.main = 0.8,
  las = 2, 
  col = rainbow(10),
  xlim = c(0, 0.6),
  main = "Emotions in Abortion Law Reinstated tweets", xlab="Percentage"
)

```









 
## Results

This section presents the main results.

### Data exploration

The results section may have a data exploration part, but in general the structure here depends on the specific project.


### Analysis

This section presents the main results, such as (for example) stats and graphs that show relationships, model results and/or clustering, PCA, etc.


## Discussion

This section summarizes the results and may briefly outline advantages and limitations of the work presented.
